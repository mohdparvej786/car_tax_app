# Stage 1: Build stage - Gradle ke saath
FROM gradle:7.6.1-jdk17 AS build

# Working directory set karo
WORKDIR /app

# Pura source code copy karo
COPY . .

# Shadow jar build karo
RUN ./gradlew shadowJar --no-daemon

# Stage 2: Runtime stage - lightweight Java runtime
FROM eclipse-temurin:17-jre-alpine

WORKDIR /app

# Build stage se fat jar copy karo
COPY --from=build /app/build/libs/car-tax-app-server-all.jar app.jar

# Server ka port expose karo
EXPOSE 8080

# Server start karne ka command
CMD ["java", "-Xms128m", "-Xmx512m", "-jar", "app.jar"]